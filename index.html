<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D FPS Game</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    // Basic setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10, 20, 10);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // Floor
    const floorGeometry = new THREE.PlaneGeometry(100, 100);
    const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // Pointer Lock Controls
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());
    scene.add(controls.getObject());

    // Movement controls
    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const keys = {};
    document.addEventListener('keydown', (e) => keys[e.code] = true);
    document.addEventListener('keyup', (e) => keys[e.code] = false);

    // Gun
    const gunGeometry = new THREE.BoxGeometry(0.2, 0.1, 1);
    const gunMaterial = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
    const gun = new THREE.Mesh(gunGeometry, gunMaterial);
    gun.position.set(0.2, -0.2, -1);
    camera.add(gun);

    // Obstacles
    const obstacles = [];
    for (let i = 0; i < 10; i++) {
      const box = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({ color: 0x5555ff }));
      box.position.set(Math.random() * 80 - 40, 1, Math.random() * 80 - 40);
      scene.add(box);
      obstacles.push(box);
    }

    // Enemies
    const enemies = [];
    const enemyGeometry = new THREE.BoxGeometry(1, 2, 1);
    const enemyMaterial = new THREE.MeshStandardMaterial({ color: 0xff0000 });
    for (let i = 0; i < 5; i++) {
      const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial.clone());
      enemy.position.set(Math.random() * 80 - 40, 1, Math.random() * 80 - 40);
      enemy.health = 100;
      scene.add(enemy);
      enemies.push(enemy);
    }

    // Shooting
    document.addEventListener('mousedown', () => {
      const raycaster = new THREE.Raycaster(camera.getWorldPosition(new THREE.Vector3()), camera.getWorldDirection(new THREE.Vector3()));
      const intersects = raycaster.intersectObjects(enemies);
      if (intersects.length > 0) {
        const enemy = intersects[0].object;
        enemy.health -= 50;
        if (enemy.health <= 0) {
          scene.remove(enemy);
          enemies.splice(enemies.indexOf(enemy), 1);
        }
      }
    });

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);

      const delta = 0.1;
      direction.z = Number(keys['KeyW']) - Number(keys['KeyS']);
      direction.x = Number(keys['KeyD']) - Number(keys['KeyA']);
      direction.normalize();

      velocity.x -= velocity.x * 10.0 * delta;
      velocity.z -= velocity.z * 10.0 * delta;
      velocity.x += direction.x * 400.0 * delta;
      velocity.z += direction.z * 400.0 * delta;

      controls.moveRight(velocity.x * delta);
      controls.moveForward(velocity.z * delta);

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
